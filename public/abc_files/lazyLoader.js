define(["jquery","isInViewport"],function(e){var t;return t=function(){function t(t){this.options=t,this.options=e.extend({},this.defaults,this.options),this.delegateEvents(),this.triggerScroll()}return t.prototype.defaults={isScrolling:[],scrollIntervalDelay:500},t.prototype.startScrollTimer=function(){return this.scrollTimer=0,setInterval(function(e){return function(){return e.scrollTimer+=50}}(this),50)},t.prototype.startScrollTimerDos=function(){return this.scrollTimerDos=0,setInterval(function(e){return function(){return e.scrollTimerDos+=50}}(this),50)},t.prototype.delegateEvents=function(){var t;return t=this,this.startScrollTimer(),this.startScrollTimerDos(),this.loadInView({$scrollEvent:e(window),viewportName:"window",mainSelector:".lazy-loader"}),this.loadInView({scrollEvent:".lazy-scrollable",viewportName:".lazy-scrollable",mainSelector:".lazy-scrollable .lazy-scroll",ajax:!0}),this.displayInView({$scrollEvent:e(window),viewportName:"window",mainSelector:".invisibility",otherSelector:".hide-me"}),e(document).ajaxComplete(function(e){return function(){return e.triggerScroll(),setTimeout(function(){return e.triggerScroll()},1e3)}}(this))},t.prototype.displayInView=function(e){var t;return t=this,setTimeout(function(t){return function(){return t.displayInViewCallback(e)}}(this),this.options.scrollIntervalDelay),e.$scrollEvent.on("scroll",function(t){return function(){return t.scrollTimerDos>t.options.scrollIntervalDelay?(t.scrollTimerDos=0,t.displayInViewCallback(e)):void 0}}(this))},t.prototype.loadInView=function(t){var r;return r=this,setTimeout(function(e){return function(){return e.loadInViewCallback(t)}}(this),this.options.scrollIntervalDelay),t.ajax?e(document).on("scroll",t.scrollEvent,function(e){return function(){return e.scrollTimer>e.options.scrollIntervalDelay?(e.scrollTimer=0,e.loadInViewCallback(t)):void 0}}(this)):t.$scrollEvent.on("scroll",function(r){return function(){return r.scrollTimer>r.options.scrollIntervalDelay?(e(".lazy-scrollable").scroll(),r.scrollTimer=0,r.loadInViewCallback(t)):void 0}}(this))},t.prototype.loadInViewCallback=function(t){var r,o,n,l;return l=this,o=e(""+t.mainSelector+":in-viewport"),n=e(""+t.mainSelector).not(o),r=n.not("* .spinner").not('[data-type="background"].already-loaded').not('[data-type="image"].already-loaded'),r.empty(),r.removeClass("already-loaded"),o.not(".already-loaded").each(function(){return l.createItem(e(this))}),this.createLoader(e(""+t.mainSelector)),this.triggerScroll()},t.prototype.displayInViewCallback=function(t){var r,o,n;return n=this,r=e(""+t.mainSelector+":in-viewport"),o=e(""+t.otherSelector).not(r),r.each(function(){return e(this).addClass("hide-me")}),o.each(function(){return e(this).removeClass("hide-me")}),this.triggerScroll()},t.prototype.triggerScroll=function(t){return null==t&&(t=500),setTimeout(function(){return function(){return e(window).trigger("scroll"),e(".lazy-scrollable").trigger("scroll")}}(this),t)},t.prototype.loaderTemplate=function(){return'<div class="spinner">\n  <div class="bounce1"></div>\n  <div class="bounce2"></div>\n  <div class="bounce3"></div>\n</div>'},t.prototype.videoTemplate=function(e){return'<video class="lazy-video" autoplay looped muted>\n	<source src="'+e.webm+'" type="video/webm">\n	<source src="'+e.mp4+'" type="video/mp4">\n</video>'},t.prototype.backgroundTemplate=function(e){return'<div class="lazy-background" style="background-image:url(\''+e.src+"')\"></div>"},t.prototype.imageTemplate=function(e){return e.src.length?'<div class="lazy-image">\n	<img src="'+e.src+'" />\n</div>':void 0},t.prototype.createItem=function(e){var t,r;switch(t=e.data(),t.type){case"video":r=this.videoTemplate(t);break;case"background":r=this.backgroundTemplate(t);break;case"image":r=this.imageTemplate(t);break;default:return!1}return e.html(r),e.addClass("already-loaded")},t.prototype.createLoader=function(t){var r;return r=this,t.not("* .spinner, .already-loaded").each(function(){var t;return t=e(this),t.append(r.loaderTemplate())})},t}()});