var __indexOf=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};define(["backbone","underscore","jquery","util/util","jquery.migrate","jquery.mobile.events"],function(t,e,o,n){var l;return l=function(){function t(t){this.options=t,this.options=o.extend(!0,{},this.defaults,this.options),this.additionalSelectors(),this.delegateEvents(),this.setDefaultDropdownSelection(),this.enableInputs()}return t.prototype.defaults={element:"#filterHolder .page-header-holder",dataValueEmptyAttr:"data-value-empty",dataRequiredAttr:"data-filter-required",filterControl:"#filterControl",filterHolder:"#filterHolder",filterSubmit:"#filterSubmit",filterSubmitUrl:null,filterSubmitUrlType:null,filterReset:"#filterReset",wildcardTokens:null,autofillDropdown:".autofillDropdown",autofillHolder:".autofillHolder",autoCompleteInput:".auto-complete-input",autoSubmitDropdown:"auto-submit-dropdown",forceAutoSubmitDropdown:!1,tournamentDropdown:"#tournamentDropdown",yearDropdown:"#yearDropdown",playerSearchUrl:"-/ajax/playersearch/playernamesearch/",dropdownList:"#filterHolder .dropdown",filterLabelList:".search-filter-label",searchResultsUrl:"/search-results?searchTerm=",$document:o(document),pageUrl:"",dropdownExpanded:!1,filterExpanded:!1,singleFilter:!1,filteredModules:!1,filterDepedencyGraph:null,overrideTransition:!1,analytics:{gaCategory:"Analytics Category",gaClickAction:"Click",gaSelectAction:"Select",gaToggleAction:"Toggle",gaSubmitLabel:"Go",gaResetLabel:"Restore Defaults",gaHideLabel:"Hide",gaShowLabel:"Show",gaLabelSearch:"Search",gaLabelGo:"Go",gaResultLabel:"Result",gaClickFilterLabel:"Click Filter"}},t.prototype.additionalSelectors=function(){return this.options.$element=o(this.options.element),this.options.$filterControl=o(this.options.filterControl),this.options.$filterHolder=o(this.options.filterHolder),this.options.$filterSubmit=o(this.options.filterSubmit),this.options.$filterReset=o(this.options.filterReset),this.options.$autofillDropdown=o(this.options.autofillDropdown),this.options.$autofillHolder=o(this.options.autofillHolder),this.options.$autoCompleteInput=o(this.options.autoCompleteInput),this.options.$tournamentDropdown=o(this.options.tournamentDropdown),this.options.$yearDropdown=o(this.options.yearDropdown),this.options.$dropdownList=o(this.options.dropdownList),this.options.$filterLabelList=o(this.options.filterLabelList)},t.prototype.delegateEvents=function(){var t;return t=this,this.options.$filterControl.on("click",function(){var e,n,l;return l=o(this),e=l.data("hide-text"),n=l.data("show-text"),t.options.filterExpanded===!1?(t.options.$filterHolder.addClass("expand"),l.find(".filter-label").text(e),window.app.Analytics.trackEvent(t.options.analytics.gaCategory,t.options.analytics.gaToggleAction,t.options.analytics.gaShowLabel),t.options.filterExpanded=!0):(t.options.$filterHolder.removeClass("expand"),l.find(".filter-label").text(n),window.app.Analytics.trackEvent(t.options.analytics.gaCategory,t.options.analytics.gaToggleAction,t.options.analytics.gaHideLabel),t.options.filterExpanded=!1)}),this.options.$document.off("click"),this.options.$document.on("click",function(e){return t.options.dropdownExpanded&&o(e.target).is(":not(.dropdown-label)")&&(o(e.target).closest("[multiselectable]").length||(t.options.$filterHolder.find(".dropdown-holder.expand").removeClass("expand"),t.options.dropdownExpanded=!1)),!0}),o(".dropdown-holder").on("click",function(e){var n,l;return l="expand",n=o(this),o(e.target).closest(".dropdown").length||!o(e.target).hasClass(l)||o(e.target).hasClass("player-input")||(o(".dropdown-holder").removeClass(l),t.options.dropdownExanpded=!1),!0}),this.options.$filterHolder.on("click",".dropdown-label:not([disabled])",function(e){var n,l,i;return e.stopPropagation(),i=o(this).closest(".dropdown-holder"),l=!1,i.hasClass("player-input")?l=!0:(o(".dropdown-holder").removeClass("expand"),!i.hasClass("disabled")&&i.hasClass("expand")?(i.removeClass("expand").siblings().removeClass("expand"),n=!1):l=!0),!l||i.hasClass("disabled")||i.hasClass("expand")?void 0:(i.addClass("expand").siblings().removeClass("expand"),t.options.dropdownExpanded=!0)}),this.options.$filterHolder.on("click","ul:not([multiselectable]) li:not([data-modal-open], .current), ul[multiselectable] li:not([data-modal-open])",function(e){return e.stopPropagation(),t.valueReplace(o(this)),o(this).parent().data("value")&&(t.filterTitle=o(this).parent().data("value")),o(this).parent().data("value")||(t.filterTitle=o.trim(o(this).siblings(":first-child").text())),""!==t.filterTitle&&window.app.Analytics.trackEvent(t.options.analytics.gaCategory,t.options.analytics.gaSelectAction,t.filterTitle),t.checkAndUpdateRequiredFieldStatus.call(t),o(this).closest(".dropdown").hasClass(t.options.autoSubmitDropdown)?(t.submitFilter(t.options.$filterHolder),t.resetFilter(t.options.$filterHolder)):void 0}),this.options.$filterHolder.on("change","select",function(e){var n,l;return e.stopPropagation(),n=o(this),t.valueReplaceMobile(n),t.options.forceAutoSubmitDropdown?(n.children().removeClass("current"),l=n.find("option[value='"+n.val()+"']"),l.addClass("current"),t.submitFilter(t.options.$filterHolder)):void 0}),this.options.$filterReset.on("click",function(){return window.app.Analytics.trackEvent(t.options.analytics.gaCategory,t.options.analytics.gaClickAction,t.options.analytics.gaResetLabel),t.resetFilter(t.options.$filterHolder)}),this.options.$element.on("focus",""+this.options.autoCompleteInput+":not([disabled])",function(e){return o(e.target).closest(".dropdown-holder").siblings(".dropdown-holder").removeClass("expand"),window.app.Analytics.trackEvent(t.options.analytics.gaCategory,t.options.analytics.gaClickAction,t.options.analytics.gaLabelSearch)}),this.options.$autoCompleteInput.on("keyup",function(e){return e.preventDefault(),32!==e.which&&""!==o.trim(e.target.value)||8!==e.which&&""!==o.trim(e.target.value)?t.autoCompleteUpdate({$element:o(e.target).closest(".dropdown-holder"),query:e.target.value}):void 0}),this.options.$autoCompleteInput.keypress(function(e){return 13===e.which?t.navigateToSearchResults():void 0}),this.options.$filterSubmit.on("click",function(){return t.submitFilter(t.options.$filterHolder)}),o("#playerInput").focusin(function(){return o("#filterControl").length?void 0:o("html").addClass("sub-nav-hidden")}),o("#playerInput").focusout(function(){return o("html").removeClass("sub-nav-hidden")})},t.prototype.setDefaultDropdownSelection=function(){return this.options.$filterHolder.find(".dropdown").each(function(){var t;return t=o(this),t.find(".current").length||t.find(".dropdown-default-label").first().addClass("current")})},t.prototype.navigateToSearchResults=function(){var t,e;return e=this.options.$autoCompleteInput.val(),t=this.options.searchResultsUrl+e,window.app.Analytics.trackEvent(_self.options.analytics.gaCategory,_self.options.analytics.gaClickAction,_self.options.analytics.gaLabelGo+" "+e),n.navigateTo(t,!0)},t.prototype.valueReplace=function(t){var e,n,l,i,r,a,s,d,u,p,c,h;if(void 0!==t.parent().attr("multiselectable"))return this.multipleSelect(t),!1;for(e=t.closest(".dropdown-holder"),t.addClass("current").siblings().removeClass("current"),n=t.closest(".dropdown-holder").children(".dropdown-label"),d=o.trim(t.text()),n.is("input")?n.val(d):n.text(d),e.removeClass("expand"),void 0!==e.data("autofillurl")&&null!==e.data("autofillurl")&&""!==e.data("autofillurl")&&(a=e.parent().next().find(".dropdown-holder"),a.addClass("disabled"),this.valueReset(a.children(".dropdown")),o.ajax({url:e.data("autofillurl")+t.data("value"),type:"GET",context:this,converters:{"* text":function(t){return o.parseJSON(t)}},success:function(t){return function(o){return o.length?t.populateDropdown(e.parent(),o):void 0}}(this),error:function(){return function(t,e,o){return console.log(t),console.log(e),console.log(o)}}(this)})),i=t.closest(".dropdown").attr("id"),c=null!=(p=this.options.filterDependencyGraph)?p:[],h=[],s=0,u=c.length;u>s;s++)r=c[s],h.push(__indexOf.call(r,i)>=0?function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)l=r[t],l!==i&&n.push(this.valueReset(o("#"+l)));return n}.call(this):void 0);return h},t.prototype.multipleSelect=function(t){return t.hasClass("current")?t.removeClass("current"):t.addClass("current")},t.prototype.valueReplaceMobile=function(t){var e;return e=t.find("option:selected").text(),t.prev().html(e)},t.prototype.valueReset=function(t){var e,n,l,i,r;return e=t.closest(".dropdown-holder"),t.children().removeClass("current"),n=e.children(".dropdown-label"),l=t.find("li.dropdown-default-label"),i=o.trim((null!=(r=t.data("force-label"))?r:"")||(null!=l?l.text():void 0)),n.text(i),e.removeClass("expand"),null==e.data("autofillurl")||(null!=l?l.click():void 0)},t.prototype.resetFilter=function(t){var e,n,l,i,r;for(r=this,t.find(".dropdown").each(function(){var t,e,n,l;return e=o(this),n=o(this).prev(),n.is("input")?(n.val(""),e.empty()):e.hasClass("keepValue")||r.valueReset(e),e.hasClass("autofillDropdown")?(t=e.find(".dropdown-default-label"),l=e.closest(".dropdown-holder"),l.addClass("disabled"),t=l.find("li.dropdown-default-label"),e.empty(),e.append(t),"undefined"==typeof defaultLabel||null===defaultLabel||e.append(t)):void 0}),i=this.options.$filterLabelList,n=0,l=i.length;l>n;n++)e=i[n],o(e).val("");return this.checkAndUpdateRequiredFieldStatus()},t.prototype.populateDropdown=function(t,e){var o,n,l,i,r,a,s,d,u,p,c,h,f;for(n=t.next().find(".dropdown-holder"),o=n.find("ul.dropdown"),l=n.find("li.dropdown-default-label"),o.empty(),o.append(l),r=this.getCurrentQueryValueForDropdown(o),d=0,c=e.length;c>d;d++)a=e[d],a.Value===r&&(a.Selected=!0);if(e.length>0){for(u=0,h=e.length;h>u;u++)s=e[u],this.appendToList(o,s);for(i=n.find(".dropdown-label"),p=0,f=e.length;f>p;p++)a=e[p],a.Selected===!0&&i.text(a.Key);n.removeClass("disabled")}return this.checkAndUpdateRequiredFieldStatus()},t.prototype.appendToList=function(t,e){var o,n;return t.append('<li data-value="'+e.Value+'" '+((null!=e.Selected&&e.Selected===!0||"")&&' class="current dropdown-default-label" ')+((null!=e.DataAttributes||"")&&" "+function(){var t,l;t=e.DataAttributes,l=[];for(o in t)n=t[o],l.push("data-"+o+'="'+n+'"');return l}().join(" "))+">"+e.Key+"</li>")},t.prototype.appendSingleFilterToList=function(t,e){var o,n;return t.append('<li data-value="'+e.Value+'" '+((null!=e.Selected&&e.Selected===!0||"")&&' class="current dropdown-default-label" ')+"><a href="+((null!=e.DataAttributes||"")&&" "+function(){var t,l;t=e.DataAttributes,l=[];for(o in t)n=t[o],l.push("data-"+o+'="'+n+'"');return l}().join(" "))+">"+e.Key+"</a></li>")},t.prototype.getCurrentQueryValueForDropdown=function(t){var e,o,n,l,i,r,a,s,d;if("wildcard"===this.options.filterSubmitUrlType){for(r={},d=this.options.wildcardTokens,a=0,s=d.length;s>a;a++)i=d[a],null==i.attribute&&(r[i.dropdown]=i);if(e=r[t.attr("id")],null!=e&&(n=window.location.pathname.split("/"),o=this.options.filterSubmitUrl.split("/"),l=o.indexOf(e.token),-1!==l))return n[l]}},t.prototype.updateQueryStringParameter=function(t,e,o){var n,l;return n=new RegExp("([?&])"+e+"=.*?(&|$)","i"),l="",l=-1!==t.indexOf("?")?"&":"?",t.match(n)?t.replace(n,"$1"+e+"="+o+"$2"):t+l+e+"="+o},t.prototype.checkAndUpdateRequiredFieldStatus=function(){var t,e;return e=this,this.options.$filterHolder.find(".dropdown-holder").removeClass("dropdown-validation-error"),t=this.options.$filterHolder.find(".dropdown").filter(function(){var t;return t=o(this),null!=t.attr(e.options.dataRequiredAttr)&&0===t.find(".current").length}),t.length>0?(this.options.$filterSubmit.addClass("disabled"),t.each(function(){var t;return t=o(this).closest(".dropdown-holder").addClass("dropdown-validation-error")}),!1):(this.options.$filterSubmit.removeClass("disabled"),!0)},t.prototype.submitFilter=function(){var t,e,l,i;if(this.checkAndUpdateRequiredFieldStatus()!==!1){if(this.options.singleFilter){if(e=o(this.options.$dropdownList[0]),t=e.children(".current"),!t.length)return this.navigateToSearchResults(),!0;l=e.children(".current").attr("data-value")}else l=this.options.filterSubmitUrl||this.options.$filterSubmit.data("resulturl"),i=this.options.filterSubmitUrlType||this.options.$filterSubmit.data("urltype"),"path"===i?l+=this.buildFilterPath():"query"===i?l+=this.buildQueryString():"wildcard"===i&&(l=this.buildWildcardPath());return n.navigateTo(l,{trigger:!0},this.options.filteredModules,"_self",this.options.overrideTransition)}},t.prototype.buildFilterPath=function(){var t,e,n,l,i,r,a,s;for(s="/",l=o(this.options.filterHolder+" div.dropdown-holder"),i=0,a=l.length;a>i;i++)e=l[i],e=o(e),n=e.children("ul.dropdown"),null!==n&&void 0!==n&&n.length>0?(t=n.children(".current"),null===t||void 0===t||t.length<1||"all"===t.data("value")?s+="all/":o.each(t,function(){var t,e;return t=o(this),e=t.attr("data-value"),t.hasClass("dropdown-default-label")&&null==e&&(e="all"),s=s+e.trim().replace(/\s/g,"-").toLowerCase()+"/"})):(r=e.children("input"),null!==r&&void 0!==r&&r.length>0&&""!==r.val()?s=s+r.val().trim().toLowerCase()+"/":s+="all/");return s},t.prototype.buildQueryString=function(){var t,e,n,l,i,r,a,s,d,u,p,c,h,f,v,g;for(v="?",s=o(this.options.filterHolder+" div.dropdown-holder"),r=location.search.replace("?","").split("&").map(function(t){var e;return e=t.split("="),{key:e[0],value:e[1],found:!1}}),d=0,c=s.length;c>d;d++)if(n=s[d],t=o(n),a=t.children("ul.dropdown"),l="",null!==a&&void 0!==a&&a.length>0?(l=a.data("value"),e=a.children(".current"),-1!==e.index()&&null!==e&&void 0!==e&&null==e.attr(this.options.dataValueEmptyAttr)&&(g=e.data("value"),e.hasClass("dropdown-default-label")&&null==g&&(g="all"),v=v+l+"="+g+"&")):(u=t.children("input"),l=u.data("value"),null!==u&&void 0!==u&&u.length>0&&""!==u.val()&&(v=v+l+"="+u.val().trim().toLowerCase()+"&")),""!==l)for(f=0;f<r.length;)r[f].key===l&&(r[f].found=!0),++f;for(p=0,h=r.length;h>p;p++)i=r[p],i.found===!1&&void 0!==i.key&&""!==i.key&&(v=v+i.key+"="+i.value+"&");return v=v.substring(0,v.length-1)},t.prototype.buildWildcardPath=function(){var t,e,n,l,i,r,a,s,d;for(n=this.options.filterSubmitUrl,s=this.options.wildcardTokens,r=0,a=s.length;a>r;r++)i=s[r],e=o(this.options.filterHolder+(" #"+i.dropdown+" > .current")),null!=e&&(t=null!=(d=i.attribute)?d:"data-value",l=e.attr(t),null!=l&&(n=n.replace(i.token,l)));return n},t.prototype.updateUrlFromDropdown=function(t,e){var n,l,i,r;return n=o("#"+e.id),r=n.attr("data-value"),l=n.children(".current"),0!==l.length&&(i=l.attr("data-value"),void 0===i&&(i=""),0!==l.length&&(t=this.updateQueryStringParameter(t,r,i))),t},t.prototype.updateUrlFromLabel=function(t,e){var n,l,i;return n=o("#"+e.id),l=n.attr("data-value"),i=n.val(),""!==i||t.indexOf(l)>=0?t=this.updateQueryStringParameter(t,l,i):t},t.prototype.autoCompleteTemplate=function(t){return this.options.singleFilter?"<li class='no-padding'>\n	<a href='"+t.Value+"'>"+t.Key+"</a>\n</li>":'<li data-value="'+t.Value+'">\n	'+t.Key+"\n</li>"},t.prototype.autoCompleteUpdate=function(t){var e;return null!=(e=this.autoCompleteAjax)&&e.abort(),this.autoCompleteAjax=o.ajax({type:"GET",url:t.$element.data("autocompleteurl")+t.query,dataType:"json"}),this.autoCompleteAjax.done(function(e){return function(o){return e.autoCompleteFilterRender({$element:t.$element.find(".auto-complete"),results:o.items})}}(this))},t.prototype.autoCompleteFilterRender=function(t){var e,o,n,l,i;for(i="",l=t.results,o=0,n=l.length;n>o;o++)e=l[o],i+=this.autoCompleteTemplate(e);return t.$element.html(i)},t.prototype.enableInputs=function(){var t;return t=this.options.$element.find("input"),t.removeAttr("disabled")},t}()});