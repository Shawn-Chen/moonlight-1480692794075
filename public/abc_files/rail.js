var __bind=function(t,e){return function(){return t.apply(e,arguments)}};define(["jquery","util/signalRController","modules/scores/liveScoresTemplate","modules/scores/liveScores","jquery.migrate","jquery.mobile.events"],function(t,e,i,a){var n;return n=function(){function n(i){this.options=i,this.reInitRailScores=__bind(this.reInitRailScores,this),this.railContainerTabEvent=__bind(this.railContainerTabEvent,this),this.railLatestTabEvent=__bind(this.railLatestTabEvent,this),this.matchMediaEvent=__bind(this.matchMediaEvent,this),this.removeActiveTabClass=__bind(this.removeActiveTabClass,this),this.options=t.extend({},this.defaults,this.options),this.signalR=e.getInstance(),this.additionalSelectors(),this.setDefaultTab(),this.adjustRailHeight(),this.railLatestInit(),this.railScoresInit(),this.delegateEvents(),this.removeActiveTabClass()}return n.prototype.liveScoresTemplate=new i({isRail:!0,mainCssClass:"scoring-section",suffix:"",gaCategory:"Right Rail - Scores"}),n.prototype.defaults={mainContainer:"#mainContainer",railDefaultTabContainer:"#railScoresContainer",rail:"#rail",railLatestTabs:"#railLatestTabs",railContainerTabs:"#railContainerTabs",railFixer:"#railFixer",railLatestContainer:"#railLatestContainer",railLatestContent:"#railLatestContent",railScoresUrl:"/assets/js/json/railScores.json",railLatestUrl:"/assets/js/json/railLatest.json",railLatestUpdateUrl:"/assets/js/json/railLatestUpdate.json",railCategoryTabs:["news","galleries","videos"],animationName:"animation-on",analytics:{gaCategory:"Right Rail",gaClickAction:"Click",gaSelectAction:"Select",gaToggleAction:"Toggle"}},n.prototype.additionalSelectors=function(){return this.options.$mainContainer=t(this.options.mainContainer),this.options.$railDefaultTab=t("[data-container="+this.options.railDefaultTabContainer+"]"),this.options.$railDefaultContainer=t(this.options.railDefaultTabContainer),this.options.$rail=t(this.options.rail),this.options.$railLatestTabs=t(this.options.railLatestTabs),this.options.$railContainerTabs=t(this.options.railContainerTabs),this.options.$railFixer=t(this.options.railFixer),this.options.$railLatestContainer=t(this.options.railLatestContainer),this.options.$railLatestContent=t(this.options.railLatestContent),this.options.$body=t("body")},n.prototype.setDefaultTab=function(){return this.options.$railDefaultTab.addClass("current"),this.options.$railDefaultContainer.addClass("current")},n.prototype.delegateEvents=function(){var e;return e=this,this.options.$body.on("click","#footer, #header, #breakingNews, #largeDropin, #mainContainer",function(){return e.options.$railFixer.removeClass("expand")}),this.options.$railContainerTabs.on("click","li",this.railContainerTabEvent),t(".rail-container").on("click","a",function(){return"#"!==t(this).attr("href")?e.options.$railFixer.removeClass("expand"):void 0}),this.options.$railLatestTabs.find("a").on("click",this.railLatestTabEvent),this.signalR.registerNewsEvent(function(t){var i,a,n,r;if(null!==t)for(r=t.items,a=0,n=r.length;n>a;a++)i=r[a],e.railLatestUpdate(i)}),this.signalR.registerScoresEvent(function(i){return null!==i?("match"===i.type?e.processMatchUpdate(i):e.processTournamentUpdate(i),e.reorderRail(),t(".lazy-scrollable").trigger("scroll")):void 0})},n.prototype.processMatchUpdate=function(t){return t.n===!0?this.railMatchAdd(a.buildMatches(t,"",!1,!0)):t.r===!0?a.removeMatch(t,"",!1,!0):a.updateMatch(t,"",!1,!0)},n.prototype.processTournamentUpdate=function(t){return t.n===!0?this.railTournamentAdd(t):t.r===!0?this.railTournamentRemove(t.tid):void 0},n.prototype.sortByRailTournamentPosition=function(t,e){return t.TournamentPosition>e.TournamentPosition?1:t.TournamentPosition<e.TournamentPosition?-1:0},n.prototype.sortByRailScorePosition=function(t,e){return t.RailPosition>e.RailPosition?1:t.RailPosition<e.RailPosition?-1:0},n.prototype.sortExistingTournaments=function(e,i){var a,n;return a=t(e).data("tournament-sort-order"),n=t(i).data("tournament-sort-order"),a>n?1:n>a?-1:0},n.prototype.railLatestData=new Array,n.prototype.railLatestInitAjax=new Array,n.prototype.tabNotClicked=!0,n.prototype.removeActiveTabClass=function(){var t,e;return e=this,matchMedia?(t=matchMedia("(max-width: 1400px)"),t.addListener(this.matchMediaEvent),this.matchMediaEvent(t)):void 0},n.prototype.adjustRailHeight=function(){return setInterval(function(t){return function(){return t.options.$rail.height()!==t.options.$mainContainer.height()?t.options.$rail.css("height",t.options.$mainContainer.height()):void 0}}(this),100)},n.prototype.matchMediaEvent=function(t){return this.tabNotClicked&&t.matches?this.options.$railContainerTabs.find(".current").removeClass("current"):void 0},n.prototype.railLatestTabEvent=function(e){var i,a,n;return e.preventDefault(),n=t(e.currentTarget).data("category"),"undefined"!==this.railLatestData[n]?(i=t(e.currentTarget).parent(),i.siblings().removeClass("current"),i.addClass("current"),a=i.children(".rail-proud-title-option").html(),this.options.$railLatestContainer.find(".rail-proud-title").html(a),this.railLatestRender(t(e.currentTarget).data("category"))):void 0},n.prototype.railContainerTabEvent=function(e){var i,a,n,r;return e.preventDefault(),a=t(e.currentTarget),n=a.data("container"),i=t(a.data("container")),r=n.replace("#rail","").replace("Container",""),this.tabNotClicked=!1,a.hasClass("current")&&this.options.$railFixer.hasClass("expand")?(this.options.$body.width()<1400&&a.removeClass("current"),this.options.$railFixer.removeClass("expand")):(a.addClass("current"),this.options.$railFixer.addClass("expand"),this.options.$body.width()<1400?window.app.Analytics.trackEvent(this.options.analytics.gaCategory,this.options.analytics.gaClickAction,"Open "+r):window.app.Analytics.trackEvent(this.options.analytics.gaCategory,this.options.analytics.gaToggleAction,r)),a.siblings().removeClass("current"),this.options.$rail.find(".rail-container").removeClass("current "+this.options.animationName),setTimeout(function(e){return function(){return i.addClass("current "+e.options.animationName),t(".lazy-scrollable").trigger("scroll")}}(this),100)},n.prototype.railLatestItemTemplate=function(t){return'<li class="listing-item">\n	<a href="'+t.Link+'" class="listing-item-thumb">\n		<div data-type="image" data-src="'+t.ImageSrc+'" data-mp4="'+t.Mp4Src+'" data-webm="'+t.WebmSrc+'" class="lazy-scroll"></div>\n	</a>\n	<div class="listing-item-info">\n		<h3 class="listing-title"><a href="'+t.Link+'">'+t.Title+'</a></h3>\n		<div class="listing-category"><span class="icon icon-type-'+t.CategoryType+'"></span><span class="listing-category-title">'+t.CategoryName+"</span></div>\n	</div>\n</li>"},n.prototype.railLatestTemplate=function(t){var e,i,a,n;for(n="",i=0,a=t.length;a>i;i++)e=t[i],n+=this.railLatestItemTemplate(e);return n},n.prototype.railLatestInit=function(){return t.each(this.options.railCategoryTabs,function(e){return function(i,a){return e.railLatestInitAjax[a]=t.ajax({type:"GET",data:{tabCategoryType:a},url:e.options.railLatestUrl,dataType:"json"}),e.railLatestInitAjax[a].done(function(t){return e.railLatestData[a]=t,"news"===a?e.railLatestRender(a):void 0})}}(this))},n.prototype.railLatestRender=function(e){var i;return this.railLatestCurrentTab=e,i=this.railLatestData[e].items,t(this.options.railLatestContent).removeClass(this.options.animationName),t(this.options.railLatestContent).find(".listing-items").html(this.railLatestTemplate(i)),this.railLatestSingleItemClasses(),setTimeout(function(e){return function(){return t(e.options.railLatestContent).addClass(e.options.animationName),t(".lazy-scrollable").trigger("scroll")}}(this),50)},n.prototype.railLatestUpdate=function(t){var e;return"undefined"===this.railLatestData[t.TabCategoryType]?!1:(null!=(e=this.railLatestData[t.TabCategoryType])&&e.items.unshift(t),this.railLatestCurrentTab===t.TabCategoryType?this.railLatestUpdateRender(t):void 0)},n.prototype.railLatestSingleItemClasses=function(e){var i,a;return null==e&&(e=t(this.options.railLatestContent).find(".listing-item:nth-child(5n)")),i=t(this.options.railLatestContent).find(".listing-item"),i.find("[data-type]").removeClass("already-loaded"),a=t(this.options.railLatestContent).find(".listing-item.single"),a.find("[data-type]").data("type","image"),a.find("[data-type]").attr("data-type","image"),a.removeClass("single"),e.each(function(){return t(this).addClass("single"),t("body").hasClass("is-desktop")&&/mp4/.test(t(this).find("[data-mp4]").data("mp4"))?(t(this).find("[data-type]").data("type","video"),t(this).find("[data-type]").attr("data-type","video")):void 0}),t(".lazy-scrollable").trigger("scroll")},n.prototype.railLatestUpdateRender=function(e){var i,a;return a=t(this.railLatestItemTemplate(e)).addClass("prepended-item")[0].outerHTML,t(this.options.railLatestContent).find(".listing-items").prepend(a),i=t(this.options.railLatestContent).find(".listing-item:nth-child(5n)"),setTimeout(function(){return function(){return t(".prepended-item").removeClass("prepended-item")}}(this),50),this.railLatestSingleItemClasses(i)},n.prototype.railScoresInit=function(){return this.railScoresInitAjax=t.ajax({type:"GET",url:this.options.railScoresUrl,dataType:"json"}),this.railScoresInitAjax.done(function(e){return function(i){var a;return a=t("#railScoresContent").find(".rail-scores-content"),i.liveScores.Tournaments.length&&(a.empty(),a.html(e.railScoresTournamentsTemplate(i.liveScores.Tournaments))),e.reorderRail()}}(this))},n.prototype.reInitRailScores=function(){return this.railScoresInit()},n.prototype.railScoresMatchesTemplate=function(t){var e,i,a,n,r;if(r="",null!==t.Matches&&void 0!==t.Matches&&t.Matches.length>0)for(n=t.Matches,i=0,a=n.length;a>i;i++)e=n[i],r+=this.liveScoresTemplate.matchTemplate(e);else r+=this.railScoresNoMatchesTemplate(t.PlayNotStarted);return r},n.prototype.railScoresTournamentsTemplate=function(e){var i,a,n,r,o,s,l,c,d,p,u,h,m;if(h="","undefined"!==e&&null!==e){for(m=[],r=0,l=e.length;l>r;r++)i=e[r],null!==i.TournamentPosition&&void 0!==i.TournamentPosition&&""!==i.TournamentPosition&&m.push(i),m.sort(this.sortByRailTournamentPosition);for(o=0,c=m.length;c>o;o++)if(n=m[o],void 0===t("#"+n.EventId)||null===t("#"+n.EventId)||t("#"+n.EventId).length<=0){for(p=[],u=n.Matches,s=0,d=u.length;d>s;s++)a=u[s],null!==a.RailPosition&&void 0!==a.RailPosition&&""!==a.RailPosition&&p.push(a);p.sort(this.sortByRailScorePosition),n.Matches=p,h+=this.railScoresTournamentTemplate(n)}return h}},n.prototype.railTournamentRemove=function(e){return t("#"+e).remove()},n.prototype.railTournamentAdd=function(e){var i,a;return i=e.td,a=[{EventId:e.tid,TournamentPosition:e.o,TournamentLink:i[0],TournamentBadgeImage:i[1],Name:i[2],Location:i[3],LiveScoresLink:i[4],LiveScoresLinkText:i[5],DrawLink:i[6],DrawLinkText:i[7],ScheduleLink:i[8],ScheduleLinkText:i[9],OfficialWebsite:i[10],Matches:[]}],t("#railScoresContent").find(".rail-scores-content").append(this.railScoresTournamentsTemplate(a)),this.reorderRail()},n.prototype.railMatchAdd=function(e){var i,a,n,r,o,s,l;for(s=[],r=0,o=e.length;o>r;r++)i=e[r],l=t("#"+i.EventId),a=l.find("#"+i.EventId+"_"+i.Id),null===a||void 0===a||a.length<=0?(t("#"+i.EventId+" .scoring-content").append(this.liveScoresTemplate.matchTemplate(i)),n=l.find("[data-sort-order]"),n.sort(this.liveScoresTemplate.sortExistingMatches),s.push(t("#"+i.EventId+" .scoring-content").html(n))):s.push(void 0);return s},n.prototype.railMatchRemove=function(e){var i,a,n,r,o,s;for(o=[],n=0,r=e.length;r>n;n++)i=e[n],s=t("#"+i.EventId),t("#"+i.EventId+"_"+i.Id).remove(),a=s.find("[data-sort-order]"),a.sort(this.liveScoresTemplate.sortExistingMatches),o.push(t("#"+i.EventId+" .scoring-content").html(a));return o},n.prototype.railMatchUpdates=function(e){var i,a,n,r;for(r=[],a=0,n=e.length;n>a;a++)i=e[a],-1!==i.Key.indexOf("ServingStatus")?r.push(this.updateServingStatus(i)):-1!==i.Key.indexOf("data-sort-order")?r.push(this.updateSortOrderNumber(i)):-1!==i.Key.indexOf("data-tournament-sort-order")?r.push(this.updateTournamentOrderNumber(i)):(i.Value||(i.Value=""),r.push(t("#"+i.Key).html(i.Value)));return r},n.prototype.reorderRail=function(){return this.reorderMatches(),this.reorderTournaments()},n.prototype.reorderMatches=function(){var e,i,a,n,r,o;for(o=t("#railScoresContent .scoring-wrapper"),r=[],a=0,n=o.length;n>a;a++)e=o[a],i=t(e).find("[data-sort-order]"),i.sort(this.liveScoresTemplate.sortExistingMatches),r.push(t("#"+t(e).attr("id")+" .scoring-content").html(i));return r},n.prototype.reorderTournaments=function(){var e;return e=t("#railScoresContent [data-tournament-sort-order]"),e.sort(this.sortExistingTournaments),e.length?t("#railScoresContent").find(".rail-scores-content").html(e):void 0},n.prototype.updateTournamentOrderNumber=function(e){var i,a;return a=e.Key.split("_"),i=a[0],t("#"+i).data("tournament-sort-order",e.Value)},n.prototype.railScoresTournamentTemplate=function(t){var e,i;return e="",""!==t.OfficialWebsite&&(i=t.OfficialWebsite.indexOf("http")>-1?t.OfficialWebsite:"http://"+t.OfficialWebsite,e="<a href="+i+' class="official-website" target="_blank">Visit Official Website<span class="icon external"></a>'),'<div class="scoring-wrapper" id="'+t.EventId+'" data-tournament-sort-order="'+t.TournamentPosition+'">\n	<div class="scoring-header">\n		<div class="tourney-details">\n			<div class="tourney-title-area"><a href="'+t.TournamentLink+'" class="tourney-badge"><img src="'+t.TournamentBadgeImage+'"></a>\n                        <div class="title-content"><a href="'+t.TournamentLink+'" class="tourney-title">'+t.Name+'</a><span class="tourney-location">'+t.Location+"</span>"+e+'</div>\n                  </div>\n			<div class="button-row-holder">\n				<div class="button-row"><a href="'+t.LiveScoresLink+'" class="button">'+t.LiveScoresLinkText+'</a><a href="'+t.DrawLink+'" class="button">'+t.DrawLinkText+"</a><a href="+t.ScheduleLink+' class="button">'+t.ScheduleLinkText+'</a></div>\n		 	</div>\n		</div>\n	</div>\n	<div class="scoring-content">\n		'+this.railScoresMatchesTemplate(t)+"\n	</div>\n </div>"},n.prototype.railScoresNoMatchesTemplate=function(t){return'<div class="scoring-section">\n	<span>'+t+"</span>\n</div>"},n}()});