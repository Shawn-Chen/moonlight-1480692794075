define(["jquery","util/util","jquery.mobile.events"],function(t,e){var s;return s=function(){function s(s){this.options=s,this.options=t.extend({},this.defaults,this.options),this.additionalSelectors(),this.delegateEvents(),e.placeholderFix()}return s.prototype.defaults={html:"html",body:"body",siteSearch:"#siteSearch",controlSearch:"#controlSearch",closeSearch:"#closeSearch",wrapper:"body > .wrapper",clearSearch:"#clearSearch",searchInput:"#siteSearch input.search",predictiveResults:"#predictiveResults",allResultsLink:".predictive-see-all",searchTermKey:"searchTerm",tournamentsUrl:"/-/ajax/PredictiveContentSearch/GetTournamentResults/",playersUrl:"/-/ajax/PredictiveContentSearch/GetPlayerResults/",tournamentsWrapper:"#tournamentsWrapper",playersWrapper:"#playersWrapper",tournamentsResults:"#tournamentListing",playersResults:"#playerListing",isMobile:t("body").hasClass("is-mobile"),isTablet:t("body").hasClass("breakpoint-768"),analytics:{gaCategory:"Main Navigation",gaAction:"Click",gaSLabel:"Search"},profilePhrase:"Profile",newsPhrase:"News",videosPhrase:"Videos",photosPhrase:"Photos"},s.prototype.delegateEvents=function(){var s;return s=this,this.options.$controlSearch.on("click",function(o){return function(r){var i;return i=o.options.$controlSearch.find(".atp-search-label"),r.preventDefault(),r.stopPropagation(),o.options.$html.hasClass("search-active")?(o.options.$html.removeClass("search-active"),o.options.isMobile||o.options.isTablet?o.scrollBackOffset():void 0):(window.app.Analytics.trackEvent(s.options.analytics.gaCategory,s.options.analytics.gaAction,s.options.analytics.gaLabel),(o.options.isMobile||o.options.isTablet)&&(o.scrollOffset=t(window).scrollTop()),o.options.$html.addClass("search-active"),o.options.isMobile||o.options.$searchInput.focus(),e.modalOpenFixScroll())}}(this)),this.options.$closeSearch.on("click",function(t){return function(){return t.options.$html.removeClass("search-active"),t.options.$searchInput.val(""),t.options.$predictiveResults.hide(),t.options.isMobile||t.options.isTablet?t.scrollBackOffset():void 0}}(this)),this.options.$clearSearch.on("click",function(t){return function(){return t.options.$searchInput.val("")}}(this)),this.options.$searchInput.on("keyup",function(t){return function(e){return t.ajaxSearch({url:t.options.tournamentsUrl,query:e.target.value,renderTo:t.options.$tournamentsWrapper,type:"tournaments",dataType:"json"}),t.ajaxSearch({url:t.options.playersUrl,query:e.target.value,renderTo:t.options.$playersWrapper,type:"players",dataType:"json"})}}(this)),this.options.$siteSearch.on("submit",function(e){return t(e.currentTarget).find("input").blur(),!1}),this.options.$allResultsLinks.on("click",function(o){var r;return o.preventDefault(),r=t(this).data().allResultsUrl+"?"+s.options.searchTermKey+"="+s.options.$searchInput.val(),e.navigateTo(r,!0)})},s.prototype.additionalSelectors=function(){return this.options.$html=t(this.options.html),this.options.$body=t(this.options.body),this.options.$siteSearch=t(this.options.siteSearch),this.options.$controlSearch=t(this.options.controlSearch),this.options.$closeSearch=t(this.options.closeSearch),this.options.$wrapper=t(this.options.wrapper),this.options.$clearSearch=t(this.options.clearSearch),this.options.$searchInput=t(this.options.searchInput),this.options.$predictiveResults=t(this.options.predictiveResults),this.options.$tournamentsWrapper=t(this.options.tournamentsWrapper),this.options.$playersWrapper=t(this.options.playersWrapper),this.options.$allResultsLinks=t(this.options.allResultsLink),this.options.$tournamentsResults=t(this.options.tournamentsResults),this.options.$playersResults=t(this.options.playersResults)},s.prototype.ajax=new Array,s.prototype.ajaxSearch=function(e){var s,o;return o=this,e.query?this.options.$predictiveResults.show():this.options.$predictiveResults.hide(),null!=(s=this.ajax[e.type])&&s.abort(),this.ajax[e.type]=t.ajax({url:e.url+e.query,type:"GET",dataType:e.dataType}),this.ajax[e.type].done(function(t){return"players"===e.type?t.items.length&&e.query?(e.renderTo.html(o.playersTemplate(t.items)),o.options.$playersResults.show()):(e.renderTo.html(""),o.options.$playersResults.hide()):"tournaments"===e.type?t.items.length&&e.query?(e.renderTo.html(o.tournamentTemplate(t.items)),o.options.$tournamentsResults.show()):(e.renderTo.html(""),o.options.$tournamentsResults.hide()):void 0})},s.prototype.scrollBackOffset=function(){return t(window).scrollTop(this.scrollOffset)},s.prototype.resultImage=function(t){return'<div class="predictive-result-image">\n	<a href="'+t.Url+'"><img onerror="this.remove()" alt="" src="'+t.ImageUrl+'"></a>\n</div>'},s.prototype.resultButton=function(t){return this.options.isMobile?"":'<div class="predictive-result-buttons">\n	<div class="button-row-holder">\n		<div class="button-row"><a href="'+t.ProfileUrl+'" class="button-border">'+this.options.profilePhrase+'</a><a href="'+t.NewsUrl+'" class="button-border">'+this.options.newsPhrase+'</a><a href="'+t.VideosUrl+'" class="button-border">'+this.options.videosPhrase+'</a><a href="'+t.PhotosUrl+'" class="button-border">'+this.options.photosPhrase+"</a></div>\n	</div>\n</div>"},s.prototype.playersTemplate=function(t){var e,s,o,r;for(r="",s=0,o=t.length;o>s;s++)e=t[s],r+='<div class="predictive-result">\n	'+this.resultImage(e)+'\n	<div class="predictive-result-title"><a href="'+e.Url+'">'+e.FirstName+" "+e.LastName+"</a></div>\n	"+this.resultButton(e)+"\n</div>";return r},s.prototype.tournamentTemplate=function(t){var e,s,o,r;for(r="",s=0,o=t.length;o>s;s++)e=t[s],r+='<div class="predictive-result">\n	'+this.resultImage(e)+'\n	<div class="predictive-result-title"><a href="'+e.Url+'">'+e.Name+'</a><span class="predictive-result-sub-title">'+e.CityLocation+"</span></div>\n	"+this.resultButton(e)+"\n</div>";return r},s}()});